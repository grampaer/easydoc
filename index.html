<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>EASYDOC - Formulaire complet</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Manrope:wght@600;800&display=swap');
    body { font-family: 'Manrope', sans-serif; }
    th { cursor: pointer; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
 
  <!-- Écran de connexion -->
  <div id="loginScreen" class="flex items-center justify-center h-screen bg-teal-50">
    <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-sm">
      <h1 class="text-2xl font-extrabold text-teal-600 mb-6 text-center">EASYDOC - Connexion</h1>
      <div class="space-y-4">
        <input id="username" type="text" placeholder="Nom d'utilisateur" class="w-full p-2 border rounded" />
        <input id="password" type="password" placeholder="Mot de passe" class="w-full p-2 border rounded" />
        <button onclick="login()" class="w-full bg-teal-600 text-white py-2 px-4 rounded hover:bg-teal-700">Se connecter</button>
      </div>
    </div>
  </div>
 
  <!-- Application principale -->
  <div id="appScreen" class="hidden">
    <header class="bg-white shadow px-6 py-4 flex justify-between items-center sticky top-0 z-50 border-b">
      <div class="text-2xl font-extrabold text-teal-600">EASYDOC</div>
      <nav class="space-x-6 text-sm font-medium text-gray-600">
        <a href="#" onclick="showPage('interventions')" class="hover:text-teal-600">Interventions</a>
        <a href="#" onclick="showPage('historique')" class="hover:text-teal-600">Historique</a>
        <a href="#" onclick="showPage('statistiques')" class="hover:text-teal-600">Statistiques</a>
        <a href="#" class="hover:text-teal-600">Paramètres</a>
        <a href="#" class="hover:text-teal-600">Compte</a>
      </nav>
    </header>
 
    <!-- Page Interventions -->
    <div id="page-interventions" class="p-6 space-y-8">
      <div class="flex">
        <aside class="w-64 bg-white border-r p-6 space-y-4 hidden md:block">
          <h2 class="text-sm font-bold text-gray-500 uppercase tracking-wide">Interventions</h2>
          <ul class="space-y-2 text-sm">
            <li><button onclick="prefill('ptg')" class="w-full text-left px-3 py-2 rounded-md hover:bg-teal-50 font-medium">PTG</button></li>
            <li><button onclick="prefill('pth')" class="w-full text-left px-3 py-2 rounded-md hover:bg-teal-50 font-medium">PTH</button></li>
            <li><button onclick="prefill('lca')" class="w-full text-left px-3 py-2 rounded-md hover:bg-teal-50 font-medium">LCA</button></li>
            <li><button onclick="prefill('menisque')" class="w-full text-left px-3 py-2 rounded-md hover:bg-teal-50 font-medium">Ménisque</button></li>
            <li><button onclick="prefill('vierge')" class="w-full text-left px-3 py-2 rounded-md hover:bg-teal-50 font-medium">Doc vierge</button></li>
          </ul>
        </aside>
 
        <main class="flex-1 p-6 space-y-8 overflow-auto">
          <section class="bg-white rounded-lg shadow p-4">
            <h2 class="text-lg font-bold text-teal-700 mb-4">Identification patient</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <input id="niss" type="text" placeholder="NISS" class="p-2 border rounded w-full" />
              <input id="nom" type="text" placeholder="Nom" class="p-2 border rounded w-full" />
              <input id="prenom" type="text" placeholder="Prénom" class="p-2 border rounded w-full" />
              <input id="naissance" type="date" placeholder="Date de naissance" class="p-2 border rounded w-full" />
              <select id="sexe" class="p-2 border rounded w-full">
                <option>Sexe</option><option>Masculin</option><option>Féminin</option><option>Indéterminé</option>
              </select>
              <input id="numPatient" type="text" placeholder="N° patient" class="p-2 border rounded w-full" />
            </div>
          </section>
 
          <section class="bg-white rounded-lg shadow p-4">
            <h2 class="text-lg font-bold text-teal-700 mb-4">Intervention</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <input id="dateOp" type="date" placeholder="Date opératoire" class="p-2 border rounded w-full" />
              <input id="anesthesie" type="text" placeholder="Anesthésiste / Type d’anesthésie" class="p-2 border rounded w-full" />
              <input id="assistants" type="text" placeholder="Assistants / Infirmiers / Internes" class="p-2 border rounded w-full" />
              <input id="typeInterv" type="text" placeholder="Type d’intervention" class="p-2 border rounded w-full" />
              <select id="cote" class="p-2 border rounded w-full">
                <option>Côté</option><option>Gauche</option><option>Droit</option><option>Bilatéral</option>
              </select>
              <input id="membre" type="text" placeholder="Membre opéré" class="p-2 border rounded w-full" />
              <input id="codesInami" type="text" placeholder="Codes INAMI" class="p-2 border rounded w-full" />
            </div>
            <button onclick="saveIntervention()" class="mt-4 bg-teal-600 text-white py-2 px-4 rounded hover:bg-teal-700">Enregistrer l’intervention</button>
          </section>
        </main>
      </div>
    </div>
 
    <!-- Page Historique (avec graphiques) -->
    <div id="page-historique" class="hidden p-6 space-y-6">
      <h2 class="text-xl font-bold text-teal-700">Historique - Graphiques</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <canvas id="chart1M"></canvas>
        <canvas id="chart1Y"></canvas>
        <canvas id="chart5Y"></canvas>
      </div>
    </div>
 
    <!-- Page Statistiques (tableau triable + recherche) -->
    <div id="page-statistiques" class="hidden p-6 space-y-6">
      <h2 class="text-xl font-bold text-teal-700">Statistiques personnelles</h2>
      <input id="searchBox" type="text" placeholder="Rechercher..." onkeyup="filterTable()" class="p-2 border rounded w-full mb-4" />
      <div class="overflow-x-auto">
        <table id="statTable" class="min-w-full bg-white border rounded shadow">
          <thead>
            <tr class="bg-gray-100 text-gray-700">
              <th onclick="sortTable(0)">Date opératoire</th>
              <th onclick="sortTable(1)">Registre national</th>
              <th onclick="sortTable(2)">Nom</th>
              <th onclick="sortTable(3)">Prénom</th>
              <th onclick="sortTable(4)">Anesthésiste</th>
              <th onclick="sortTable(5)">Assistant</th>
              <th onclick="sortTable(6)">Type intervention</th>
              <th onclick="sortTable(7)">Code INAMI</th>
            </tr>
          </thead>
          <tbody id="statTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>
 
  <script>
    let historique = [];
    let sortDirection = true;
 
    const presets = {
      ptg: { nom: "Dupont", prenom: "Jean", naissance: "1970-01-01", niss: "12345678901", numPatient: "A001", sexe: "Masculin", typeInterv: "PTG" },
      pth: { nom: "Martin", prenom: "Paul", naissance: "1965-05-12", niss: "23456789012", numPatient: "A002", sexe: "Masculin", typeInterv: "PTH" },
      lca: { nom: "Durand", prenom: "Luc", naissance: "1985-09-20", niss: "34567890123", numPatient: "A003", sexe: "Masculin", typeInterv: "LCA" },
      menisque: { nom: "Petit", prenom: "Louis", naissance: "1990-03-15", niss: "45678901234", numPatient: "A004", sexe: "Masculin", typeInterv: "Ménisque" },
      vierge: { nom: "", prenom: "", naissance: "", niss: "", numPatient: "", sexe: "Sexe", typeInterv: "" }
    };
 
    function login() {
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('appScreen').classList.remove('hidden');
      showPage('interventions');
    }
 
    function showPage(page) {
      document.getElementById('page-interventions').classList.add('hidden');
      document.getElementById('page-historique').classList.add('hidden');
      document.getElementById('page-statistiques').classList.add('hidden');
 
      if (page === 'interventions') document.getElementById('page-interventions').classList.remove('hidden');
      if (page === 'historique') { document.getElementById('page-historique').classList.remove('hidden'); renderCharts(); }
      if (page === 'statistiques') document.getElementById('page-statistiques').classList.remove('hidden');
    }
 
    function prefill(type) {
      const data = presets[type];
      if (data) {
        document.getElementById('nom').value = data.nom;
        document.getElementById('prenom').value = data.prenom;
        document.getElementById('naissance').value = data.naissance;
        document.getElementById('niss').value = data.niss;
        document.getElementById('numPatient').value = data.numPatient;
        document.getElementById('sexe').value = data.sexe;
        document.getElementById('typeInterv').value = data.typeInterv;
      }
    }
 
    function saveIntervention() {
      const intervention = {
        nom: document.getElementById('nom').value,
        prenom: document.getElementById('prenom').value,
        naissance: document.getElementById('naissance').value,
        niss: document.getElementById('niss').value,
        numPatient: document.getElementById('numPatient').value,
        sexe: document.getElementById('sexe').value,
        dateOp: document.getElementById('dateOp').value,
        anesthesie: document.getElementById('anesthesie').value,
        assistants: document.getElementById('assistants').value,
        typeInterv: document.getElementById('typeInterv').value,
        codesInami: document.getElementById('codesInami').value
      };
      historique.push(intervention);
      updateStatTable();
      alert("Intervention enregistrée !");
    }
 
    function updateStatTable() {
      const body = document.getElementById('statTableBody');
      body.innerHTML = '';
      historique.forEach((h, i) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${h.dateOp}</td>
          <td>${h.niss}</td>
          <td>${h.nom}</td>
          <td>${h.prenom}</td>
          <td>${h.anesthesie}</td>
          <td>${h.assistants}</td>
          <td>${h.typeInterv}</td>
          <td>${h.codesInami}</td>
        `;
        row.classList.add('hover:bg-teal-50','cursor-pointer');
        row.onclick = () => editIntervention(i);
        body.appendChild(row);
      });
    }
 
    function editIntervention(index) {
      const h = historique[index];
      showPage('interventions');
      document.getElementById('nom').value = h.nom;
      document.getElementById('prenom').value = h.prenom;
      document.getElementById('naissance').value = h.naissance;
      document.getElementById('niss').value = h.niss;
      document.getElementById('numPatient').value = h.numPatient;
      document.getElementById('sexe').value = h.sexe;
      document.getElementById('dateOp').value = h.dateOp;
      document.getElementById('anesthesie').value = h.anesthesie;
      document.getElementById('assistants').value = h.assistants;
      document.getElementById('typeInterv').value = h.typeInterv;
      document.getElementById('codesInami').value = h.codesInami;
    }
 
    function filterTable() {
      const query = document.getElementById('searchBox').value.toLowerCase();
      const rows = document.querySelectorAll('#statTable tbody tr');
      rows.forEach(row => {
        row.style.display = row.innerText.toLowerCase().includes(query) ? '' : 'none';
      });
    }
 
    function sortTable(colIndex) {
      const table = document.getElementById('statTable');
      const rows = Array.from(table.rows).slice(1);
      rows.sort((a, b) => {
        const aText = a.cells[colIndex].innerText;
        const bText = b.cells[colIndex].innerText;
        return sortDirection ? aText.localeCompare(bText) : bText.localeCompare(aText);
      });
      sortDirection = !sortDirection;
      const body = document.getElementById('statTableBody');
      body.innerHTML = '';
      rows.forEach(r => body.appendChild(r));
    }
 
    function renderCharts() {
      const ctx1 = document.getElementById('chart1M').getContext('2d');
      const ctx2 = document.getElementById('chart1Y').getContext('2d');
      const ctx3 = document.getElementById('chart5Y').getContext('2d');
 
      new Chart(ctx1, { type: 'bar', data: { labels: ['S1','S2','S3','S4'], datasets:[{label:'Interventions (1 mois)', data:[3,5,2,4], backgroundColor:'teal'}] }});
 
      new Chart(ctx2, { type: 'line', data: { labels:['Jan','Fév','Mar','Avr','Mai'], datasets:[{label:'1 an', data:[10,15,12,20,18], borderColor:'teal', fill:false},{label:'Moyenne', data:[15,15,15,15,15], borderColor:'orange', borderDash:[5,5], fill:false}] }});
 
      new Chart(ctx3, { type: 'line', data: { labels:['2020','2021','2022','2023','2024'], datasets:[{label:'5 ans', data:[100,120,90,150,170], borderColor:'teal', fill:false},{label:'Tendance', data:[126,126,126,126,126], borderColor:'orange', borderDash:[5,5], fill:false}] }});
    }
  </script>
</body>
</html>
